<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>PreferenceRank</title>
        <style>
            :root {
                --p: #0070ea;
                --ph: #005bc0;
                --bg: #f9f9ff;
                --bgc: #fff;
                --txt: #414754;
                --brd: #c1c6d7;
                --bh: #d7d9e5
            }

            @media(prefers-color-scheme: dark) {
                :root:not(.light) {
                    --bg:#10131b;
                    --bgc: #181c23;
                    --txt: #c1c6d7;
                    --brd: #414754;
                    --bh: #10131b
                }
            }

            :root.dark {
                --bg: #10131b;
                --bgc: #181c23;
                --txt: #c1c6d7;
                --brd: #414754;
                --bh: #10131b
            }

            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0
            }

            body {
                background: var(--bg);
                color: var(--txt);
                display: flex;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
                padding: 1rem;
                font-family: sans-serif
            }

            .c {
                background: var(--bgc);
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0,0,0,.1);
                max-width: 720px;
                padding: 2rem;
                width: 100%;
                position: relative
            }

            .c:has(#i:not(.h)) {
                padding-top: 3rem
            }

            .h {
                display: none!important
            }

            h1,h2 {
                margin: .5rem 0;
                text-align: left
            }

            .fg {
                margin-bottom: 1rem
            }

            label {
                display: block;
                font-weight: 700;
                margin-bottom: .5rem
            }

            input,select,textarea,button {
                background: var(--bgc);
                border: 1px solid var(--brd);
                border-radius: 4px;
                color: var(--txt);
                font-size: 1rem;
                padding: .5rem;
                width: 100%
            }

            textarea {
                min-height: 80px;
                resize: vertical
            }

            button {
                cursor: pointer;
                transition: background .2s
            }

            .bp {
                background: var(--p);
                border: none;
                color: #fff
            }

            .bp:hover {
                background: var(--ph)
            }

            .bs {
                background: var(--bgc);
                color: var(--txt)
            }

            .bs:hover {
                background: var(--bh)
            }

            #b,#rb,#tb {
                display: flex;
                gap: 1rem;
                margin-top: 1rem
            }

            #b button,#tb button,#rb button {
                flex: 1
            }

            #b button,#tb button {
                font-size: 1.2rem;
                min-height: 100px
            }

            #p {
                font-size: 1.1rem;
                margin-top: 1rem;
                text-align: center
            }

            #kt {
                background: var(--bg);
                border: 1px solid var(--brd);
                border-radius: 4px;
                font-size: .85rem;
                line-height: 1.5;
                margin-top: 15px;
                opacity: .9;
                padding: 8px;
                text-align: center
            }

            #kt kbd {
                background: var(--bgc);
                border: 1px solid var(--brd);
                border-radius: 3px;
                box-shadow: 0 1px 1px rgba(0,0,0,.2);
                display: inline-block;
                font-family: monospace;
                font-size: .9em;
                margin: 0 3px;
                padding: 2px 5px
            }

            #ktt {
                background: none;
                border: none;
                color: var(--p);
                cursor: pointer;
                display: block;
                font-size: .85rem;
                margin: 10px auto 0;
                padding: 0;
                text-decoration: underline;
                width: auto
            }

            .sel {
                position: absolute;
                right: 2rem;
                top: 1rem;
                display: flex;
                gap: 8px
            }

            .sel select {
                font-size: .9rem;
                padding: 5px;
                width: auto
            }

            .chk {
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 1rem
            }

            .chk input {
                width: auto
            }

            .chk label {
                margin: 0
            }

            #r table {
                border-collapse: collapse;
                margin-top: 1rem;
                width: 100%
            }

            #r th,#r td {
                border: 1px solid var(--brd);
                padding: .5rem;
                text-align: left
            }

            #r th {
                background: var(--p);
                color: #fff
            }

            #u {
                margin-top: 1rem;
                width: auto
            }

            #u:disabled {
                background: var(--bh);
                cursor: not-allowed
            }

            .selected {
                background: var(--p)!important;
                color: #fff!important
            }

            @media(max-width: 768px) {
                .c {
                    padding:1.5rem
                }

                .c:has(#i:not(.h)) {
                    padding-top: calc(1.5rem + 1rem)
                }

                .sel {
                    gap: 4px;
                    right: .5rem;
                    top: .5rem
                }

                .sel select {
                    font-size: .8rem;
                    padding: 4px
                }

                #b,#tb,#rb {
                    flex-direction: column
                }

                #b button,#tb button {
                    width: 100%
                }
            }
        </style>
    </head>
    <body>
        <div class="c">
            <div id="i">
                <h1 id="t"></h1>
                <div class="sel">
                    <select id="ls">
                        <option value="en">English</option>
                        <option value="id">Bahasa Indonesia</option>
                    </select>
                    <select id="ts">
                        <option value="auto" id="at"></option>
                        <option value="light" id="lt"></option>
                        <option value="dark" id="dt"></option>
                    </select>
                </div>
                <div class="fg">
                    <label for="ii" id="iil"></label>
                    <textarea id="ii" rows="5" spellcheck="false"></textarea>
                </div>
                <div class="chk">
                    <input type="checkbox" id="at2"/>
                    <label for="at2" id="atl"></label>
                </div>
                <div class="chk">
                    <input type="checkbox" id="qr"/>
                    <label for="qr" id="qrl"></label>
                </div>
                <button id="sb" class="bp"></button>
            </div>
            <div id="bs" class="h">
                <button id="u" class="bs" disabled></button>
                <div id="b">
                    <button id="li" class="bs"></button>
                    <button id="ri" class="bs"></button>
                </div>
                <div id="tb" class="h">
                    <button id="tib" class="bs"></button>
                </div>
                <div id="p"></div>
                <button id="ktt"></button>
                <div id="kt" class="h"></div>
            </div>
            <div id="r" class="h"></div>
            <div id="rb" class="h">
                <button id="rbb" class="bp"></button>
                <button id="rnb" class="bp"></button>
            </div>
        </div>
        <script>
            const $ = id=>document.getElementById(id)
              , T = {
                en: {
                    t: "PreferenceRank",
                    at: "Auto Theme",
                    lt: "Light",
                    dt: "Dark",
                    iil: "Enter items, one per line:",
                    atl: "Allow Ties",
                    qrl: "Use Quick Rank (fewer comparisons)",
                    a: "Please enter at least two items.",
                    da: "{count} duplicate item(s) were found and have been removed.",
                    sb: "Start Ranking",
                    tib: "It's a Tie",
                    u: "Undo",
                    p: "Progress",
                    ktt: "Show keyboard shortcuts",
                    ktth: "Hide keyboard shortcuts",
                    ktw: "Keyboard Shortcuts:<br><kbd>←</kbd> Choose left item<br><kbd>→</kbd> Choose right item<br><kbd>↑</kbd> or <kbd>↓</kbd> It's a Tie<br><kbd>Ctrl/⌘</kbd>+<kbd>Z</kbd> Undo last choice",
                    ktn: 'Keyboard Shortcuts:<br><kbd>←</kbd> Choose left item<br><kbd>→</kbd> Choose right item<br><kbd>Ctrl/⌘</kbd>+<kbd>Z</kbd> Undo last choice',
                    res: "Results",
                    rk: "Rank",
                    itm: "Item",
                    sc: "Score",
                    rbb: "Restart Battle",
                    rnb: "Start with New Items"
                },
                id: {
                    t: "PreferenceRank",
                    at: "Tema Otomatis",
                    lt: "Terang",
                    dt: "Gelap",
                    iil: "Masukkan pilihan, satu per baris:",
                    atl: "Izinkan Seri",
                    qrl: "Gunakan Peringkat Cepat (lebih sedikit perbandingan)",
                    a: "Harap masukkan setidaknya dua pilihan.",
                    da: "{count} item duplikat ditemukan dan telah dihapus.",
                    sb: "Mulai Peringkat",
                    tib: "Seri",
                    u: "Urungkan",
                    p: "Kemajuan",
                    ktt: "Tampilkan pintasan papan ketik",
                    ktth: "Sembunyikan pintasan papan ketik",
                    ktw: "Pintasan Papan Ketik:<br><kbd>←</kbd> Pilih pilihan kiri<br><kbd>→</kbd> Pilih pilihan kanan<br><kbd>↑</kbd> atau <kbd>↓</kbd> Seri<br><kbd>Ctrl/⌘</kbd>+<kbd>Z</kbd> Urungkan pilihan terakhir",
                    ktn: "Pintasan Papan Ketik:<br><kbd>←</kbd> Pilih pilihan kiri<br><kbd>→</kbd> Pilih pilihan kanan<br><kbd>Ctrl/⌘</kbd>+<kbd>Z</kbd> Urungkan pilihan terakhir",
                    res: "Hasil",
                    rk: "Peringkat",
                    itm: "Nama",
                    sc: "Skor",
                    rbb: "Mulai Ulang Pertarungan",
                    rnb: "Mulai dengan Pilihan Baru"
                }
            };
            class P {
                constructor(n) {
                    this.n = n
                }
                shuffle(a) {
                    for (let i = a.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [a[i],a[j]] = [a[j], a[i]]
                    }
                }
                markAsCompared() {}
                unmarkAsCompared() {}
            }
            class FP extends P {
                constructor(n) {
                    super(n);
                    this.pairs = [];
                    for (let i = 0; i < n - 1; i++)
                        for (let j = i + 1; j < n; j++)
                            this.pairs.push([i, j]);
                    this.shuffle(this.pairs)
                }
                getNextPair(s) {
                    return this.pairs[s.pr]
                }
                getTotal() {
                    return this.pairs.length
                }
            }
            class QP extends P {
                constructor(n) {
                    super(n);
                    this.cp = new Set()
                }
                getNextPair(s) {
                    const si = Array.from({
                        length: this.n
                    }, (_,i)=>i).sort((a,b)=>s.sc[b] - s.sc[a]);
                    for (let i = 0; i < this.n - 1; i++) {
                        const p1 = si[i]
                          , p2 = si[i + 1]
                          , pr = [Math.min(p1, p2), Math.max(p1, p2)]
                          , pk = `${pr[0]}-${pr[1]}`;
                        if (!this.cp.has(pk))
                            return pr
                    }
                    return null
                }
                markAsCompared(pr) {
                    this.cp.add(`${pr[0]}-${pr[1]}`)
                }
                unmarkAsCompared(pr) {
                    this.cp.delete(`${pr[0]}-${pr[1]}`)
                }
            }
            class PR {
                constructor() {
                    this.s = {
                        it: [],
                        sc: [],
                        cp: null,
                        sw: false,
                        pr: 0,
                        tot: 0,
                        ties: false,
                        lng: navigator.language?.startsWith("id") ? "id" : "en",
                        thm: "auto",
                        h: [],
                        ke: false,
                        ch: false
                    };
                    this.init()
                }
                t(k, r={}) {
                    let tr = T[this.s.lng][k] || k;
                    Object.entries(r).forEach(([p,v])=>tr = tr.replace(`{${p}}`, v));
                    return tr
                }
                init() {
                    this.ui = {
                        ls: $("ls"),
                        ts: $("ts"),
                        at2: $("at2"),
                        qr: $("qr"),
                        sb: $("sb"),
                        li: $("li"),
                        ri: $("ri"),
                        tib: $("tib"),
                        rbb: $("rbb"),
                        rnb: $("rnb"),
                        u: $("u"),
                        ktt: $("ktt"),
                        i: $("i"),
                        bs: $("bs"),
                        r: $("r"),
                        rb: $("rb"),
                        tb: $("tb"),
                        kt: $("kt"),
                        p: $("p"),
                        ii: $("ii"),
                        t: $("t"),
                        at: $("at"),
                        lt: $("lt"),
                        dt: $("dt"),
                        iil: $("iil"),
                        atl: $("atl"),
                        qrl: $("qrl")
                    };
                    this.ui.ls.addEventListener("change", ()=>this.upLng());
                    this.ui.ts.addEventListener("change", e=>{
                        this.s.thm = e.target.value;
                        this.apThm()
                    }
                    );
                    this.ui.at2.addEventListener("change", e=>{
                        this.s.ties = e.target.checked;
                        if (!this.ui.bs.classList.contains("h")) {
                            this.ui.tb.classList.toggle("h", !this.s.ties);
                            this.upKT()
                        }
                    }
                    );
                    this.ui.sb.addEventListener("click", ()=>this.start());
                    this.ui.li.addEventListener("click", ()=>this.choose("left"));
                    this.ui.ri.addEventListener("click", ()=>this.choose("right"));
                    this.ui.tib.addEventListener("click", ()=>this.choose("tie"));
                    this.ui.rbb.addEventListener("click", ()=>this.restart());
                    this.ui.rnb.addEventListener("click", ()=>this.restartNew());
                    this.ui.u.addEventListener("click", ()=>this.undo());
                    this.ui.ktt.addEventListener("click", ()=>this.togKT());
                    document.addEventListener("keydown", e=>this.kd(e));
                    this.ui.ls.value = this.s.lng;
                    this.apThm();
                    this.upLng()
                }
                apThm() {
                    document.documentElement.classList.remove("light", "dark");
                    if (this.s.thm !== "auto")
                        document.documentElement.classList.add(this.s.thm)
                }
                upLng() {
                    this.s.lng = this.ui.ls.value;
                    ["t", "at", "lt", "dt", "iil", "atl", "qrl", "sb", "tib", "u", "rbb", "rnb"].forEach(k=>this.ui[k].textContent = this.t(k));
                    this.upKT();
                    this.ui.ktt.textContent = this.t(this.ui.kt.classList.contains("h") ? "ktt" : "ktth");
                    this.upPr();
                    if (!this.ui.r.classList.contains("h"))
                        this.showRes()
                }
                upKT() {
                    this.ui.kt.innerHTML = this.t(this.s.ties ? "ktw" : "ktn")
                }
                start() {
                    const raw = this.ui.ii.value.split("\n").map(s=>s.trim()).filter(Boolean)
                      , it = [...new Set(raw)]
                      , rc = raw.length - it.length;
                    if (rc > 0)
                        alert(this.t("da", {
                            count: rc
                        }));
                    if (it.length < 2)
                        return alert(this.t("a"));
                    this.s.it = it;
                    this.s.ties = this.ui.at2.checked;
                    this.reset();
                    this.ui.tb.classList.toggle("h", !this.s.ties);
                    this.togKT(true);
                    this.upKT();
                    this.show("bs");
                    this.next()
                }
                reset() {
                    const n = this.s.it.length;
                    this.s.sc = Array(n).fill(1000);
                    this.s.pr = 0;
                    this.s.h = [];
                    this.ui.u.disabled = true;
                    this.s.pp = this.ui.qr.checked ? new QP(n) : new FP(n);
                    this.s.tot = this.ui.qr.checked ? 0 : this.s.pp.getTotal()
                }
                choose(w) {
                    if (this.s.ch)
                        return;
                    this.s.ch = true;
                    const pw = (w === "left" && !this.s.sw) || (w === "right" && this.s.sw)
                      , res = w === "tie" ? .5 : pw ? 1 : 0;
                    this.s.h.push({
                        pr: this.s.cp,
                        sc: [...this.s.sc],
                        pb: this.s.pr
                    });
                    this.s.pp.markAsCompared(this.s.cp);
                    const [i1,i2] = this.s.cp
                      , [s1,s2] = [this.s.sc[i1], this.s.sc[i2]]
                      , e1 = 1 / (1 + 10 ** ((s2 - s1) / 400));
                    this.s.sc[i1] += 32 * (res - e1);
                    this.s.sc[i2] += 32 * (e1 - res);
                    this.s.pr++;
                    this.ui.u.disabled = false;
                    this.upPr();
                    ["li", "ri", "tib"].forEach(id=>this.ui[id].classList.remove("selected"));
                    (w === "tie" ? this.ui.tib : this.ui[`${w[0]}i`]).classList.add("selected");
                    setTimeout(()=>{
                        this.s.ch = false;
                        this.next()
                    }
                    , 300)
                }
                next() {
                    ["li", "ri", "tib"].forEach(id=>this.ui[id].classList.remove("selected"));
                    const np = this.s.pp.getNextPair(this.s);
                    if (!np || (!this.ui.qr.checked && this.s.pr >= this.s.tot))
                        return this.showRes();
                    this.s.cp = np;
                    let[i1,i2] = np;
                    this.s.sw = Math.random() < .5;
                    if (this.s.sw)
                        [i1,i2] = [i2, i1];
                    this.ui.li.textContent = this.s.it[i1];
                    this.ui.ri.textContent = this.s.it[i2];
                    this.upPr()
                }
                upPr() {
                    const pt = this.ui.qr.checked ? `${this.t("p")}: ${this.s.pr}` : `${this.t("p")}: ${this.s.pr}/${this.s.tot}`;
                    this.ui.p.textContent = pt
                }
                showRes() {
                    const si = this.s.it.map((it,i)=>({
                        it,
                        sc: this.s.sc[i]
                    })).sort((a,b)=>b.sc - a.sc);
                    this.ui.r.innerHTML = `<h2>${this.t("res")}</h2><table><thead><tr><th style="width:20%">${this.t("rk")}</th><th style="width:60%">${this.t("itm")}</th><th style="width:20%">${this.t("sc")}</th></tr></thead><tbody>${si.map(({it, sc},i)=>`<tr><td>${i + 1}</td><td>${it}</td><td>${Math.round(sc)}</td></tr>`).join("")}</tbody></table>`;
                    this.show("r")
                }
                show(id) {
                    ["i", "bs", "r"].forEach(s=>this.ui[s].classList.toggle("h", s !== id));
                    this.ui.rb.classList.toggle("h", id !== "r");
                    this.s.ke = id === "bs"
                }
                undo() {
                    if (this.s.ch || !this.s.h.length)
                        return;
                    const l = this.s.h.pop();
                    this.s.sc = l.sc;
                    this.s.pr = l.pb;
                    this.s.pp.unmarkAsCompared(l.pr);
                    this.next();
                    this.ui.u.disabled = !this.s.h.length
                }
                restart() {
                    this.reset();
                    this.show("bs");
                    this.next()
                }
                restartNew() {
                    const {lng, thm} = this.s;
                    this.s = {
                        it: [],
                        sc: [],
                        cp: null,
                        sw: false,
                        pr: 0,
                        tot: 0,
                        ties: false,
                        lng,
                        thm,
                        h: [],
                        ke: false,
                        ch: false
                    };
                    this.ui.ls.value = lng;
                    this.ui.ii.value = "";
                    this.ui.at2.checked = false;
                    this.ui.qr.checked = false;
                    this.show("i");
                    this.upLng()
                }
                togKT(f) {
                    const h = this.ui.kt.classList.toggle("h", f);
                    this.ui.ktt.textContent = this.t(h ? "ktt" : "ktth")
                }
                kd(e) {
                    if (!this.s.ke || ["SELECT", "INPUT", "TEXTAREA"].includes(document.activeElement.tagName))
                        return;
                    const km = {
                        ArrowLeft: ()=>this.ui.li.click(),
                        ArrowRight: ()=>this.ui.ri.click(),
                        ArrowUp: ()=>this.s.ties && this.ui.tib.click(),
                        ArrowDown: ()=>this.s.ties && this.ui.tib.click(),
                        z: ()=>(e.ctrlKey || e.metaKey) && this.ui.u.click()
                    };
                    if (km[e.key]) {
                        e.preventDefault();
                        km[e.key]()
                    }
                }
            }
            new PR();
        </script>
    </body>
</html>
